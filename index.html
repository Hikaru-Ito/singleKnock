<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello React!</title>
    <script src="build/react.js"></script>
    <script src="build/react-dom.js"></script>
    <script src="https://unpkg.com/babel-core@5.8.38/browser.min.js"></script>
    <style type="text/css">
      body {
        font-family: 'Hiragino Kaku Gothic Pro', 'ヒラギノ角ゴ Pro W3', Meiryo, メイリオ, Osaka, 'MS PGothic', arial, helvetica, sans-serif;
      }
    </style>
  </head>
  <body>
    <div id="main"></div>
    <script type="text/babel">

    // サンプルデータ
    let data = []
    for(let i = 0; i < 10; i += 1) {
      let item = {}
      item["title"] = "title" + i
      item["key"] = i
      item["children"] = []
      for(let j = 0; j < 10; j += 1) {
        let itemJ = {}
        itemJ["title"] = "title" + i + "-" + j
        itemJ["key"] = i+""+j
        itemJ["children"] = []
        item.children.push(itemJ)
      }
      data.push(item)
    }

    // 選択位置
    let pos = [0]
    //longPressのTimerを入れとく変数
    let timer
    //longPressか判断する変数
    let longPress

    // Class宣言
    let Main = React.createClass({
      moveCur: function() {
      },
      mouseDown: function(e) {
        longPress = false
        timer = setTimeout(this.pressTimer, 500)
      },
      mouseUp: function(e) {
        clearTimeout(timer)
        if(longPress) {
          pos.push(0)
          console.log("LongPress")
        } else {
          console.log("shortPress")
          pos[pos.length-1] = (data.length-1 === pos[pos.length-1] ? 0 : pos[pos.length-1] + 1)
        }
        this.forceUpdate()
      },
      pressTimer: function() {
        longPress = true
      },
      render: function() {
        return (
          <div onMouseDown={this.mouseDown} onMouseUp={this.mouseUp}>
            <Items items={data}/>
          </div>
        );
      }
    })
    let Item = React.createClass({
      render: function() {
        let style = {
          backgroundColor: pos.join('') == this.props.class ? "#000000" : "#FFFFFF"
        }

        return (<div className={this.props.class} style={style}>
          {this.props.text}
          <Items items={this.props.items}/>
          </div>);
      }
    })

    let Items = React.createClass({
      render: function() {
        let items = this.props.items.map(function(item, idx) {
          return (
            <Item text={item.title} class={item.key} items= {item.children} key={item.key}>
            </Item>
          )
        })
        return <div>{items}</div>;
      }
    })

    //描画
    ReactDOM.render(
      <Main />,
      document.getElementById('main')
    );
    </script>
  </body>
</html>